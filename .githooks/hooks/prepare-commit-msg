#!/bin/bash
# Git Hook: prepare-commit-msg
# Ricorda di aggiornare documentazione prima del commit

COMMIT_MSG_FILE=$1
COMMIT_SOURCE=$2

# Skip se Ã¨ un merge o amend
if [ "$COMMIT_SOURCE" = "merge" ] || [ "$COMMIT_SOURCE" = "squash" ]; then
    exit 0
fi

# Controlla se ci sono modifiche significative al codice
SIGNIFICANT_FILES=$(git diff --cached --name-only | grep -E '\.(py|ts|tsx|js|jsx|sql)$')

if [ -n "$SIGNIFICANT_FILES" ]; then
    echo ""
    echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
    echo "  ğŸ“ REMINDER: Aggiorna la Documentazione!"
    echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
    echo ""
    echo "Hai modificato file di codice. Considera di aggiornare:"
    echo ""
    echo "  ğŸ“‹ CHANGELOG.md"
    echo "     â””â”€ Aggiungi entry nella sezione [Unreleased]"
    echo ""
    echo "  ğŸ—ï¸  ARCHITECTURE.md"
    echo "     â””â”€ Aggiorna se ci sono modifiche architetturali"
    echo ""
    echo "  ğŸ“– README.md"
    echo "     â””â”€ Aggiorna se nuove features o setup changes"
    echo ""
    echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
    echo ""

    # Controlla se CHANGELOG Ã¨ stato modificato
    if ! git diff --cached --name-only | grep -q "CHANGELOG.md"; then
        echo "âš ï¸  CHANGELOG.md non Ã¨ stato modificato!"
        echo ""
        read -p "Vuoi continuare comunque? (y/N) " -n 1 -r
        echo ""
        if [[ ! $REPLY =~ ^[Yy]$ ]]; then
            echo "âŒ Commit annullato. Aggiorna la documentazione e riprova."
            exit 1
        fi
    fi
fi

exit 0
